import { PvmBackend } from "@typeberry/config";
import { tryAsGas } from "@typeberry/pvm-interface";
import { HostCalls } from "./host-calls.js";
import { HostCallsManager, NoopMissing } from "./host-calls-manager.js";
import { InterpreterInstanceManager } from "./interpreter-instance-manager.js";

const hostCalls = new HostCallsManager({ missing: new NoopMissing(), handlers: [] });
const pvmInstanceManager = await InterpreterInstanceManager.new(PvmBackend.BuiltIn);
const pvmHostCallExtension = new HostCalls(pvmInstanceManager, hostCalls);

const program = new Uint8Array([
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x10, 0x1, 0x0, 0x0, 0xf9, 0x0, 0x0, 0x0, 0x0, 0x0, 0x80, 0xd9, 0x5, 0x12,
  0x0, 0x0, 0x0, 0x5, 0x11, 0x0, 0x0, 0x0, 0x5, 0xa3, 0x0, 0x0, 0x0, 0x5, 0xc6, 0x0, 0x4, 0x7, 0x13, 0x0, 0x2, 0x11,
  0xa4, 0x3, 0x10, 0x58, 0x3, 0x15, 0x54, 0x3, 0x16, 0x50, 0xd, 0x11, 0x1c, 0xd, 0x11, 0x18, 0xd, 0x11, 0x14, 0xd, 0x11,
  0x10, 0xd, 0x11, 0xc, 0xd, 0x11, 0x8, 0xd, 0x11, 0x4, 0xd, 0x1, 0xd, 0x11, 0x3c, 0xd, 0x11, 0x38, 0xd, 0x11, 0x34,
  0xd, 0x11, 0x30, 0xd, 0x11, 0x2c, 0xd, 0x11, 0x28, 0xd, 0x11, 0x24, 0xd, 0x11, 0x20, 0xd, 0x11, 0x40, 0x52, 0x18, 0x4,
  0x9, 0x20, 0x2, 0x1a, 0x40, 0x4, 0xb, 0x4, 0x4, 0x7, 0x4e, 0x2, 0x1, 0x15, 0x40, 0xd, 0x11, 0x44, 0x2, 0x18, 0x20,
  0x4, 0x9, 0x20, 0x2, 0x1a, 0x44, 0x4, 0xb, 0x4, 0x4, 0x7, 0x4e, 0x2, 0x1, 0x16, 0x44, 0x3, 0x15, 0x48, 0x52, 0x17,
  0x4, 0x8, 0x20, 0x2, 0x19, 0x48, 0x4, 0xa, 0x4, 0x4e, 0x3, 0x3, 0x16, 0x4c, 0x2, 0x17, 0x20, 0x4, 0x8, 0x20, 0x2,
  0x19, 0x4c, 0x4, 0xa, 0x4, 0x4e, 0x3, 0x4, 0x7, 0x1, 0x10, 0x58, 0x1, 0x15, 0x54, 0x1, 0x16, 0x50, 0x2, 0x11, 0x5c,
  0x13, 0x0, 0x2, 0x11, 0xec, 0x3, 0x10, 0x10, 0xd, 0x11, 0x8, 0xd, 0x11, 0x4, 0xd, 0x1, 0x1a, 0x11, 0xf, 0x2, 0x17,
  0xf, 0x4, 0x8, 0x1, 0x52, 0x19, 0x4, 0xa, 0xc, 0x4e, 0x3, 0x4, 0x7, 0x1, 0x10, 0x10, 0x2, 0x11, 0x14, 0x13, 0x0, 0x4,
  0x7, 0x13, 0x0, 0x21, 0x84, 0x54, 0x92, 0x24, 0x49, 0x92, 0x92, 0x24, 0x49, 0x52, 0x92, 0x4a, 0x92, 0xa4, 0x92, 0x92,
  0x94, 0x24, 0xa9, 0x24, 0x29, 0x49, 0x4a, 0x52, 0x2a, 0xa9, 0x0,
]);
const args = new Uint8Array();

(async () => {
  await pvmHostCallExtension.runProgram(program, args, 5, tryAsGas(1000));
})();
