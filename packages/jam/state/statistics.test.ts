import { describe, it } from "node:test";
import { BytesBlob } from "@typeberry/bytes";
import { Decoder } from "@typeberry/codec";
import { tinyChainSpec } from "@typeberry/config";
import { Compatibility, GpVersion } from "@typeberry/utils";
import { StatisticsData } from "./statistics.js";

describe("Statistics", () => {
  const STATISTICS = Compatibility.selectIfGreaterOrEqual({
    fallback:
      "0x010000000300000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000100000000000000030000000600000000000000000000000000000000000000010000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000810e0000000000000000000100000000000001000000000000000000",
    versions: {
      // varu32 for serviceid + no onTransfer
      [GpVersion.V0_7_1]:
        "0x010000000300000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000100000000000000030000000600000000000000000000000000000000000000010000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000810e000000000000000000010000000000000100000000000000",
    },
  });
  it("should decode statistics data with no error", () => {
    Decoder.decodeObject(StatisticsData.Codec, BytesBlob.parseBlob(STATISTICS), tinyChainSpec);
  });
});
